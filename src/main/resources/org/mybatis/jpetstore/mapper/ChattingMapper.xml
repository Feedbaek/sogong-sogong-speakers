<?xml version="1.0" encoding="UTF-8"?>

<!--
<taglib xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-jsptaglibrary_2_1.xsd"
        version="2.1">
    <tlib-version>1.0</tlib-version>
    <short-name>myshortname</short-name>
    <uri>http://mycompany.com</uri>
    &lt;!&ndash; Invoke 'Generate' action to add tags or functions &ndash;&gt;
</taglib>
-->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.mybatis.jpetstore.mapper.ChattingMapper">

    <cache />

    <select id="getChatRoomByIdForManager" resultType="ChattingRoom">
        SELECT c.customerid as customerid,
               c.managerid as managerid
        FROM chattingRoom c
        WHERE c.managerId=#{managerId}
        ORDER BY c.customerId;
    </select>

    <select id="getChatRoomByIdForUser" resultType="ChattingRoom">
        SELECT customerid,
               managerid
        FROM ChattingRoom c
        WHERE c.customerid=#{customerId}
        ORDER BY c.managerId;
    </select>

    <select id="getSearchedChatRoomList" resultType="ChattingRoom">
        SELECT customerid,
               managerid
        FROM ChattingRoom c
        WHERE c.customerid like #{customerId} and c.managerid=#{managerId}
    </select>

    <select id="getChatLog" resultType="Chatting">
        SELECT customerid,
               managerid,
               ChattingLog,
               senderId,
               timeTable
        FROM ChattingLog
        WHERE customerid=#{customerId} AND managerid=#{managerId}
    </select>

    <insert id="insertChattingRoom" parameterType="ChattingRoom">
        INSERT INTO ChattingRoom
            (customerid,managerid)
        VALUES
            (#{customerId},#{managerId})
    </insert>

    <insert id="insertChatting" parameterType="Chatting">
        INSERT INTO ChattingLog
            (customerid,managerid,ChattingLog,senderId,timeTable)
        VALUES
            (#{customerId},#{managerId},#{chattingLog},#{senderId},NOW())
    </insert>

    <delete id="deleteChattingRoom" parameterType="chattingRoom">
        DELETE FROM ChattingRoom
        WHERE customerid=#{customerId} AND managerid=#{managerId}
    </delete>

    <select id="getMemoById" resultType="Memo">
        SELECT managerid,
               customerid,
               petname,
               petcategory,
               petage,
               startdate,
               evallog,
               curstatus
        FROM chattingeval
        WHERE managerid=#{param1} and customerid=#{param2};
    </select>

    <update id="updateMemo" parameterType="Memo">
        UPDATE chattingeval
        SET petname=#{petName}, petcategory=#{petCategory}, petage=#{petAge}, evallog=#{evalLog}, curstatus=#{curStatus}
        WHERE managerid=#{managerId} and customerid=#{customerId};
    </update>

    <insert id="insertMemo" parameterType="Memo">
        INSERT INTO chattingeval
        (managerid, customerid, petname, petcategory, petage, startdate, evallog, curstatus)
        VALUES (#{managerId}, #{customerId}, #{petName}, #{petCategory}, #{petAge}, NOW(), #{evalLog}, #{curStatus});
    </insert>

</mapper>